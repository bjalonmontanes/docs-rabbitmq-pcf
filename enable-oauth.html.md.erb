---
title: Enabling OAuth
owner: RabbitMQ
---

This topic explains how to enable OAuth.

## <a id='overview'></a> Overview

This option enables the OAuth 2 plugin for RabbitMQ. This enables apps and users to authenticate
and authorize using JWT-encoded OAuth 2.0 access tokens.

To enable OAuth for an on-demand offering:

1. [Create a UAA Group for OAuth](#create-uaa-group)
1. [Enable OAuth in <%= vars.ops_manager %>](#enable-oauth)
1. [Configure UAA Groups for RabbitMQ](#configure-uaa-groups)

## <a id='create-uaa-group'></a> Create a UAA Group for OAuth

<%# Needs stem and steps. %>

## <a id='enable-oauth'></a> Enable OAuth in <%= vars.ops_manager %>

To enable OAuth in <%= vars.ops_manager %>:

1. Go to the **Security for On-Demand Plans** section of the <%= vars.app_runtime_abbr %> tile.
1. Select the **Enable OAuth** checkbox.
1. Click **Save**.
1. Apply changes <%# Click **Apply Changes** ? %>

![Enable OAuth](/images/enable-oauth.png)

## <a id='configure-uaa-groups'></a> Configure UAA Groups for RabbitMQ

1. [Install UAA and Create UAA Admin](#install-uaa)
2. [Create UAA Groups for RabbitMQ](#create-rmq-uaa-group)
3. [Configure Users for the RabbitMQ UAA Groups](#configure-users)

## <a id='uaa-admin-user'></a> Create an Admin User for UAA

To install and authenticate with UAA:

1. Create an admin user for UAA by following the steps in [Create an Admin User](https://docs.pivotal.io/platform/application-service/2-9/uaa/uaa-user-management.html#-create-an-admin-user).

To fetch the UAA Admin Client secret from the <%= vars.ops_manager %> UI:

1. Click on the <%= vars.app_runtime_full %> tile.
1. Click the **Credentials** tab.
    ![Credentials tab](/images/oauth-create-uaa-group-1.png)
1. Locate the Admin Client Credentials in the UAA job.
    ![Admin Client Credential](/images/oauth-create-uaa-group-2.png)
1. Click **Link to Credential**.
1. Copy the text in the password field. This is the UAA Admin Client secret.


### <a id='create-rmq-uaa-group'></a> Create a UAA Group for RabbitMQ Permissions

After creating an admin user in UAA, the next step is to create a group for RabbitMQ permissions and
map user groups to those permissions.

For each space in <%= vars.app_runtime_full %> that contains RabbitMQ instances you must enable access through OAuth.

To enable access through OAuth:

1. Display the space GUID for a RabbitMQ on-demand instance by running:

    ```
    cf space SPACE-NAME --guid
    ```
    Where `SPACE-NAME` is the name of the space.

    Record the space GUID.

1. Create a UAA group using the space GUID and RabbitMQ tag by running:

    ```
    uaac group add p-rabbitmq_SPACE-GUID.tag:RABBITMQ-TAG
    ```

    Where:
    * `SPACE-GUID` is the space GUID.
    * `RABBITMQ-TAG` is the RabbitMQ tag. For more information about RabbitMQ tags, see the
    [RabbitMQ documentation](https://www.rabbitmq.com/management.html#permissions)

    For example:
    <pre class="terminal">
      $ uaac group add p-rabbitmq_64bd9d4d-d2c8-4207-bb76-91a245e67d9d.tag:policymaker
    </pre>


### <a id='configure-users'></a> Configure Users for the RabbitMQ UAA Groups

You can either map external identity provider groups to the RabbitMQ UAA groups or add UAA members
to the groups.

Do one of the following:

- Map the RabbitMQ UAA group created above to your identity provider group by following the steps in [Grant Admin Permissions to an External Group (SAML, LDAP, or OIDC)](https://docs.pivotal.io/platform/application-service/uaa/uaa-user-management.html#external-group).

The users in the identity provider group mapped above gain the permissions specified by the RabbitMQ
tag provided in the UAA group name.

- Add UAA members to UAA groups by running:

    ```
    uaac member add GROUP-NAME USERNAME
    ```

    Where:
    * `GROUP-NAME` is the UAA group name.
    * `USERNAME` is a UAA group member.
